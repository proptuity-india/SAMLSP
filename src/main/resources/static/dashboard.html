<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACME | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        primaryHover: '#4F46E5',
                        darkBg: '#0F172A',
                        darkCard: '#1E293B',
                        lightText: '#E2E8F0',
                        mutedText: '#94A3B8',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .cursor-not-allowed {
            cursor: not-allowed;
        }
        .opacity-50 {
            opacity: 0.5;
        }
        #user-photo-container {
            transition: all 0.3s ease;
        }

        #user-photo {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-darkBg font-sans text-lightText min-h-screen">

<!-- Navigation Bar -->
<nav class="flex items-center justify-between px-8 py-4 border-b border-gray-700">
    <div class="flex items-center">
        <svg class="w-8 h-8 text-primary" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
            <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="ml-2 text-xl font-semibold">ACME</span>
    </div>
    <div class="flex items-center space-x-6">
        <!-- Logout Button -->
        <button id="local-logout-btn"
                class="flex items-center text-mutedText hover:text-lightText transition-colors hover:bg-gray-700 px-3 py-1 rounded-md">
            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            Logout
        </button>

        <!-- Photo or Avatar -->
        <div id="user-photo-container" class="h-8 w-8 rounded-full overflow-hidden flex items-center justify-center bg-primary">
            <img id="user-photo" class="hidden h-full w-full object-cover" alt="User photo">
            <span id="user-avatar" class="text-white font-medium">JD</span>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="flex">
    <!-- Sidebar -->
<!--    <div class="w-64 p-4 border-r border-gray-700 hidden md:block">-->
<!--        <div class="mb-8">-->
<!--            <h3 class="text-sm uppercase font-semibold text-mutedText mb-4">Navigation</h3>-->
<!--            <ul class="space-y-2">-->
<!--                <li><a href="#" class="flex items-center space-x-2 text-lightText hover:text-primary"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg><span>Dashboard</span></a></li>-->
<!--                <li><a href="#" class="flex items-center space-x-2 text-mutedText hover:text-primary"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><span>Sales</span></a></li>-->
<!--                <li><a href="#" class="flex items-center space-x-2 text-mutedText hover:text-primary"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg><span>Marketing</span></a></li>-->
<!--            </ul>-->
<!--        </div>-->
<!--    </div>-->

    <!-- Dashboard Content -->
    <div class="flex-1 p-8 animate-fade-in">
        <!-- User Profile -->
        <div class="bg-darkCard rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-primary">User Profile</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <p class="text-sm text-mutedText">First Name</p>
                    <p class="font-medium" id="firstname">Loading...</p>
                </div>
                <div>
                    <p class="text-sm text-mutedText">Last Name</p>
                    <p class="font-medium" id="lastname">Loading...</p>
                </div>
                <div>
                    <p class="text-sm text-mutedText">Email</p>
                    <p class="font-medium" id="email">Loading...</p>
                </div>
                <div>
                    <p class="text-sm text-mutedText">User ID</p>
                    <p class="font-medium" id="userId">Loading...</p>
                </div>
                <div>
                    <p class="text-sm text-mutedText">Title</p>
                    <p class="font-medium" id="title">Loading...</p>
                </div>
                <div>
                    <p class="text-sm text-mutedText">Department</p>
                    <p class="font-medium" id="role">Loading...</p>
                </div>
                <div class="md:col-span-3">
                    <p class="text-sm text-mutedText">Groups</p>
                    <div id="groups-container" class="flex flex-wrap gap-2 mt-2">
                        <!-- Groups will be added here dynamically -->
                        <span class="text-xs text-mutedText">Loading groups...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <!-- In the Tabs section, modify the nav element -->
        <div class="border-b border-gray-700 mb-6">
            <nav class="-mb-px flex space-x-8" id="dashboard-tabs">
                <!-- Sales Tab - will be shown/hidden based on role -->
                <button id="sales-tab" onclick="showDashboard('sales')"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-mutedText hover:text-lightText sales-tab">
                    Sales Dashboard
                </button>

                <!-- Marketing Tab - will be shown/hidden based on role -->
                <button id="marketing-tab" onclick="showDashboard('marketing')"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-mutedText hover:text-lightText marketing-tab">
                    Marketing Dashboard
                </button>
            </nav>
        </div>

        <!-- Sales Dashboard -->
        <div id="sales-dashboard" class="dashboard-content hidden">
            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Total Sales -->
                <div class="bg-darkCard rounded-xl p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-mutedText mb-1">Total Sales</p>
                            <p class="text-3xl font-bold">$125,680</p>
                            <p class="text-sm text-success mt-2 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                </svg>
                                12.5% from last month
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Conversion Rate -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Conversion Rate</p>
                    <p class="text-3xl font-bold">23.5%</p>
                    <div class="mt-4">
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: 23.5%"></div>
                        </div>
                    </div>
                </div>

                <!-- App Deal -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">App Deal</p>
                    <p class="text-3xl font-bold">$4,280</p>
                    <p class="text-sm text-warning mt-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        New deal closed today
                    </p>
                </div>

                <!-- Non Customers -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Non Customers</p>
                    <p class="text-3xl font-bold">48</p>
                    <p class="text-sm text-mutedText mt-2">In pipeline</p>
                </div>

                <!-- Churn Rate -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Churn Rate</p>
                    <p class="text-3xl font-bold">3.2%</p>
                    <p class="text-sm text-danger mt-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                        </svg>
                        0.8% from last quarter
                    </p>
                </div>

                <!-- Sales Target -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Quarter Target</p>
                    <p class="text-3xl font-bold">78%</p>
                    <div class="mt-4">
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: 78%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Sales by Category -->
                <div class="bg-darkCard rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Sales by Category</h3>
                    <div class="h-64">
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-2">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-primary mr-2"></div>
                            <span class="text-sm">Software</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-success mr-2"></div>
                            <span class="text-sm">Hardware</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-warning mr-2"></div>
                            <span class="text-sm">Service</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-danger mr-2"></div>
                            <span class="text-sm">Training</span>
                        </div>
                    </div>
                </div>

                <!-- Monthly Sales -->
                <div class="bg-darkCard rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Monthly Sales</h3>
                    <div class="h-64">
                        <canvas id="monthlySalesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Marketing Dashboard -->
        <div id="marketing-dashboard" class="dashboard-content hidden">
            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Total Leads -->
                <div class="bg-darkCard rounded-xl p-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-mutedText mb-1">Total Leads</p>
                            <p class="text-3xl font-bold">1,245</p>
                            <p class="text-sm text-success mt-2 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                                </svg>
                                18.3% from last month
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Campaign ROI -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Campaign ROI</p>
                    <p class="text-3xl font-bold">312.5%</p>
                    <div class="mt-4">
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                </div>

                <!-- CTR -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">CTR</p>
                    <p class="text-3xl font-bold">4.8%</p>
                    <p class="text-sm text-warning mt-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Above industry average
                    </p>
                </div>

                <!-- CAC -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">CAC</p>
                    <p class="text-3xl font-bold">$568</p>
                    <p class="text-sm text-mutedText mt-2">Customer Acquisition Cost</p>
                </div>

                <!-- Social Reach -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">Social Reach</p>
                    <p class="text-3xl font-bold">24,600</p>
                    <p class="text-sm text-success mt-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                        </svg>
                        32% growth
                    </p>
                </div>

                <!-- MQL Target -->
                <div class="bg-darkCard rounded-xl p-6">
                    <p class="text-sm text-mutedText mb-1">MQL Target</p>
                    <p class="text-3xl font-bold">65%</p>
                    <div class="mt-4">
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Lead Sources -->
                <div class="bg-darkCard rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Lead Sources</h3>
                    <div class="h-64">
                        <canvas id="leadSourcesChart"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-2">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-primary mr-2"></div>
                            <span class="text-sm">Social Media</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-success mr-2"></div>
                            <span class="text-sm">FIRM</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-warning mr-2"></div>
                            <span class="text-sm">Content</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-danger mr-2"></div>
                            <span class="text-sm">PPC</span>
                        </div>
                    </div>
                </div>

                <!-- Campaign Performance -->
                <div class="bg-darkCard rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Campaign Performance</h3>
                    <div class="h-64">
                        <canvas id="campaignPerformanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize charts
    function initCharts() {
        // Sales by Category Chart
        const categoryCtx = document.getElementById('categoryChart')?.getContext('2d');
        if (categoryCtx) {
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Software', 'Hardware', 'Service', 'Training'],
                    datasets: [{
                        data: [45, 30, 15, 10],
                        backgroundColor: [
                            '#6366F1',
                            '#10B981',
                            '#F59E0B',
                            '#EF4444'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Monthly Sales Chart
        const monthlyCtx = document.getElementById('monthlySalesChart')?.getContext('2d');
        if (monthlyCtx) {
            new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Sales',
                        data: [15000, 22000, 18000, 25000, 21000, 32000, 28000],
                        borderColor: '#6366F1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointBackgroundColor: '#6366F1',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Lead Sources Chart
        const leadSourcesCtx = document.getElementById('leadSourcesChart')?.getContext('2d');
        if (leadSourcesCtx) {
            new Chart(leadSourcesCtx, {
                type: 'pie',
                data: {
                    labels: ['Social Media', 'FIRM', 'Content', 'PPC', 'Direct'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: [
                            '#6366F1',
                            '#10B981',
                            '#F59E0B',
                            '#EF4444',
                            '#8B5CF6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Campaign Performance Chart
        const campaignCtx = document.getElementById('campaignPerformanceChart')?.getContext('2d');
        if (campaignCtx) {
            new Chart(campaignCtx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Leads',
                        data: [1200, 1900, 1500, 2200],
                        backgroundColor: '#6366F1',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
    }

    // Modify the fetchUserProfile function to handle role-based UI
    async function fetchUserProfile() {
        try {
            const response = await fetch('/api/user/profile');
            const data = await response.json();

            // Populate user details
            document.getElementById('firstname').innerText = data.firstname;
            document.getElementById('lastname').innerText = data.lastname;
            document.getElementById('email').innerText = data.email;
            document.getElementById('role').innerText = data.role;
            document.getElementById('userId').innerText = data.uid || 'U001';
            document.getElementById('title').innerText = data.title || 'Employee';

            // Handle groups display
            const groupsContainer = document.getElementById('groups-container');
            groupsContainer.innerHTML = ''; // Clear loading message

            if (data.groups && data.groups.length > 0) {
                data.groups.forEach(group => {
                    const groupElement = document.createElement('span');
                    groupElement.className = 'px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary';
                    groupElement.textContent = group;
                    groupsContainer.appendChild(groupElement);
                });
            } else {
                groupsContainer.innerHTML = '<span class="text-xs text-mutedText">No groups assigned</span>';
            }

            // Set avatar initials as fallback
            const avatarElement = document.getElementById('user-avatar');
            avatarElement.innerText = data.firstname.charAt(0) + (data.lastname?.charAt(0) || '');

            // Handle user photo if available
            const photoContainer = document.getElementById('user-photo-container');
            const photoElement = document.getElementById('user-photo');

            if (data.photo && data.photo.trim() !== '') {
                // Show photo and hide avatar
                photoElement.src = `${data.photo}`;
                photoElement.classList.remove('hidden');
                avatarElement.classList.add('hidden');

                // Adjust styling for photo
                photoContainer.classList.remove('bg-primary');
            } else {
                // Show avatar and hide photo
                photoElement.classList.add('hidden');
                avatarElement.classList.remove('hidden');

                // Ensure avatar has background color
                photoContainer.classList.add('bg-primary');
            }

            // Get role and convert to lowercase for case-insensitive comparison
            const userRole = data.role.toLowerCase();
            const salesTab = document.getElementById('sales-tab');
            const marketingTab = document.getElementById('marketing-tab');

            // Reset both tabs to enabled state first
            salesTab.classList.remove('opacity-50', 'cursor-not-allowed');
            salesTab.disabled = false;
            marketingTab.classList.remove('opacity-50', 'cursor-not-allowed');
            marketingTab.disabled = false;

            // Show appropriate dashboard based on role
            if (userRole.includes('sales')) {
                showDashboard('sales');
            } else if (userRole.includes('marketing')) {
                showDashboard('marketing');
            } else {
                // Default case (admin/other roles) - both enabled, show sales first
                showDashboard('sales');
            }

            // Initialize charts after data is loaded
            initCharts();
        } catch (error) {
            console.error('Error fetching user profile:', error);
            // Fallback - both tabs enabled if API fails
            showDashboard('sales');
            initCharts();
        }
    }

    function showDashboard(section) {
        // Get current role (you might need to store this from the profile fetch)
        const userRole = document.getElementById('role').innerText.toLowerCase();

        // Check if user has access to this dashboard
        if ((section === 'sales' && !userRole.includes('sales')) ||
            (section === 'marketing' && !userRole.includes('marketing'))) {
            return; // Don't show the dashboard
        }

        // Hide all dashboards
        document.querySelectorAll('.dashboard-content').forEach(div => {
            div.classList.add('hidden');
        });

        // Update tab styles
        document.querySelectorAll('[id$="-tab"]').forEach(tab => {
            tab.classList.remove('border-primary', 'text-lightText');
            tab.classList.add('border-transparent', 'text-mutedText');
        });

        // Show the selected dashboard
        const dashboard = document.getElementById(`${section}-dashboard`);
        if (dashboard) {
            dashboard.classList.remove('hidden');
            document.getElementById(`${section}-tab`).classList.remove('border-transparent', 'text-mutedText');
            document.getElementById(`${section}-tab`).classList.add('border-primary', 'text-lightText');
        }
    }
    window.onload = fetchUserProfile;

    document.addEventListener('DOMContentLoaded', function() {
        fetchUserProfile(); // Load user data

        // Proper logout button implementation
        const logoutBtn = document.getElementById('local-logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Logout initiated'); // Debug log

                // Clear client-side storage if needed
                localStorage.clear();
                sessionStorage.clear();

                // Redirect to logout endpoint
                window.location.href = '/local-logout';

                // Fallback redirect in case of issues
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1000);
            });
        } else {
            console.error('Logout button not found!');
        }
    });
</script>
</body>
</html>